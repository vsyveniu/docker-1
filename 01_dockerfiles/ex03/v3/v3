FROM debian:latest

RUN apt-get update && apt-get -y upgrade && \
	apt-get -y install git && \
	apt-get -y install wget && \
	apt-get -y install ca-certificates &&\
	apt-get -y install openssh-server && \
	apt-get -y install apt-transport-https && \
	apt-get -y install curl && \
	apt-get -y install gnupg && \
	apt-get -y install systemd 

RUN wget -q -O - https://packages.gitlab.com/gpg.key | apt-key add -a
RUN apt-get update
RUN curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | bash
RUN echo 'deb https://packages.gitlab.com/gitlab/gitlab-ce/ubuntu/ xenial main' >> /etc/apt/sources.list.d/gitlab_gitlab-ce.list && echo 'deb-src https://packages.gitlab.com/gitlab/gitlab-ce/ubuntu/ xenial main' >> /etc/apt/sources.list.d/gitlab_gitlab-ce.
RUN EXTERNAL_URL="http://gitlabfuck:30080" apt-get -y install  --no-install-recommends gitlab-ce
RUN cp /opt/gitlab/embedded/cookbooks/runit/files/default/gitlab-runsvdir.conf /etc/init/
RUN initctl start gitlab-runsvdir
RUN gitlab-ctl reconfigure